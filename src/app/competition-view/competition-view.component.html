<div class="competition-container" *ngIf="currentSeason$ | async as season">
  <!-- Logo -->
  <div class="logo-container">
    <img src="assets/images/SemoSVI_blk_transparent_stroke.png" alt="SemoSVI Logo" class="competition-logo">
  </div>
  
  <!-- House Name Poll -->
  <div class="section poll-section" *ngIf="houseNamePoll">
    <div class="poll-container">
      <div class="poll-header">
        <h2>{{ houseNamePoll.title }}</h2>
        <p class="poll-description">{{ houseNamePoll.description }}</p>
        <div class="poll-meta">
          <span class="poll-status" [class.active]="isPollActive()" [class.ended]="!isPollActive()">
            {{ isPollActive() ? 'üó≥Ô∏è Poll Active' : 'üìä Voting Ended' }}
          </span>
          <span class="poll-countdown" *ngIf="pollCountdown">
            ‚è∞ {{ pollCountdown }}
          </span>
          <span class="poll-votes">{{ getTotalVotes() }} total votes</span>
          <span class="poll-deadline" *ngIf="houseNamePoll.endDate">
            Ends: {{ houseNamePoll.endDate | date:'MMM d, y' }}
          </span>
        </div>
      </div>

      <!-- Voting Interface -->
      <div class="poll-voting" *ngIf="isPollActive() && !hasVoted">
        <p class="voting-instructions">
          Select up to {{ houseNamePoll.maxSelections }} house names:
        </p>
        <div class="poll-options">
          <div 
            class="poll-option"
            *ngFor="let option of houseNamePoll.options"
            [class.selected]="houseNamePoll.userVotes.includes(option.id)"
            (click)="onPollOptionToggle(option.id)"
          >
            <div class="option-content">
              <div class="option-header">
                <span class="option-emblem">{{ option.emblem }}</span>
                <span class="option-name">{{ option.name }}</span>
                <div class="option-checkbox">
                  <input 
                    type="checkbox" 
                    [checked]="houseNamePoll.userVotes.includes(option.id)"
                    readonly
                    [attr.aria-label]="'Select ' + option.name"
                  >
                </div>
              </div>
            </div>
          </div>
        </div>
        
        <div class="poll-actions">
          <div class="vote-counter">
            Selected: {{ houseNamePoll.userVotes.length }} / {{ houseNamePoll.maxSelections }}
          </div>
          <button 
            class="btn btn-primary vote-btn"
            [disabled]="houseNamePoll.userVotes.length === 0"
            (click)="submitPollVotes()"
          >
            Submit Votes ({{ houseNamePoll.userVotes.length }})
          </button>
        </div>
      </div>

      <!-- Already Voted Message -->
      <div class="poll-voted" *ngIf="hasVoted">
        <div class="voted-message">
          <h3>‚úÖ Thank you for voting!</h3>
          <p>You voted for:</p>
          <div class="user-votes">
            <span 
              class="voted-option"
              *ngFor="let voteId of houseNamePoll.userVotes"
            >
              {{ getOptionEmblem(voteId) }}
              {{ getOptionName(voteId) }}
            </span>
          </div>
        </div>
      </div>

      <!-- Poll Results Toggle -->
      <div class="poll-results-toggle">
        <button 
          class="btn btn-secondary"
          (click)="togglePollResults()"
        >
          {{ showPollResults ? 'Hide' : 'Show' }} Results
        </button>
      </div>

      <!-- Poll Results -->
      <div class="poll-results" *ngIf="showPollResults">
        <h3>Current Results</h3>
        <div class="results-list">
          <div 
            class="result-item"
            *ngFor="let option of getPollResults(); let i = index"
            [class.top-three]="i < 3"
          >
            <div class="result-rank">
              <span class="rank-number">{{ i + 1 }}</span>
              <span class="rank-badge" *ngIf="i < 3">üèÜ</span>
            </div>
            <div class="result-content">
              <div class="result-header">
                <span class="result-emblem">{{ option.emblem }}</span>
                <span class="result-name">{{ option.name }}</span>
              </div>
              <div class="result-stats">
                <div class="vote-bar">
                  <div 
                    class="vote-fill"
                    [style.width.%]="getVotePercentage(option)"
                    [style.background-color]="option.color"
                  ></div>
                </div>
                <span class="vote-count">{{ option.votes }} votes ({{ getVotePercentage(option) | number:'1.1-1' }}%)</span>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<div class="loading" *ngIf="!(currentSeason$ | async)">
  <p>Loading competition data...</p>
</div>

<!-- Secret Manager Portal Modal -->
<div class="secret-modal-overlay" *ngIf="showSecretModal" (click)="closeSecretModal()">
  <div class="secret-modal" (click)="$event.stopPropagation()">
    <div class="secret-modal-header">
      <h2>üîí Manager Portal Access</h2>
      <button class="close-btn" (click)="closeSecretModal()">&times;</button>
    </div>
    <div class="secret-modal-content">
      <p>Enter your credentials to access the admin portal:</p>
      <div class="form-inputs">
        <div class="input-container">
          <input 
            type="text" 
            [(ngModel)]="username" 
            placeholder="Username..."
            class="form-input"
            (keyup.enter)="submitManagerPassword()">
        </div>
        <div class="input-container">
          <input 
            type="password" 
            [(ngModel)]="password" 
            placeholder="Password..."
            class="form-input"
            (keyup.enter)="submitManagerPassword()">
        </div>
      </div>
      <div class="modal-actions">
        <button class="btn btn-primary" (click)="submitManagerPassword()" [disabled]="isLoading">
          <span *ngIf="!isLoading">Access Portal</span>
          <span *ngIf="isLoading">Authenticating...</span>
        </button>
        <button class="btn btn-secondary" (click)="closeSecretModal()" [disabled]="isLoading">
          Cancel
        </button>
      </div>
      <div class="secret-hint">
        <small>üí° Hint: Type "secret" anywhere on this page to open this dialog</small>
      </div>
    </div>
  </div>
</div>
