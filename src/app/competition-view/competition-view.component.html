<div class="competition-container" *ngIf="currentSeason$ | async as season">
  <!-- Season Header -->
  <div class="season-header">
    <h1>{{ season.name }}</h1>
    <p class="season-dates">
      {{ season.startDate | date:'MMM d, y' }} - {{ season.endDate | date:'MMM d, y' }}
    </p>
  </div>

  <!-- House Rankings -->
  <div class="section">
    <h2>House Standings</h2>
    <div class="house-rankings">
      <div 
        class="house-card" 
        *ngFor="let house of getHouseRanking(season.houses); let i = index"
        [style.border-left]="'4px solid ' + house.color"
      >
        <div class="house-rank">#{{ i + 1 }}</div>
        <div class="house-info">
          <div class="house-name">
            <span class="house-emblem">{{ house.emblem }}</span>
            {{ house.displayName }}
          </div>
          <div class="house-leader" *ngIf="house.leader">Led by {{ house.leader }}</div>
          <div class="house-description">{{ house.description }}</div>
        </div>
        <div class="house-points">
          <span class="points-value">{{ house.points }}</span>
          <span class="points-label">points</span>
        </div>
      </div>
    </div>
  </div>

  <!-- Recent Events -->
  <div class="section">
    <h2>Recent Events</h2>
    <div class="events-list">
      <div 
        class="event-card" 
        *ngFor="let event of getRecentEvents(season.events)"
        [class.completed]="event.isCompleted"
      >
        <div class="event-info">
          <div class="event-name">{{ event.name }}</div>
          <div class="event-date">{{ event.date | date:'MMM d, y' }}</div>
          <div class="event-type">{{ event.type | titlecase }}</div>
          <div class="event-description" *ngIf="event.description">{{ event.description }}</div>
        </div>
        <div class="event-results" *ngIf="event.isCompleted">
          <h4>House Points Earned:</h4>
          <div class="house-points-list">
            <ng-container *ngFor="let house of season.houses">
              <div 
                class="house-points-item" 
                *ngIf="event.housePoints[house.id]"
              >
                <span class="house-name" [style.color]="house.color">
                  {{ house.emblem }} {{ house.displayName }}
                </span>
                <span class="points">+{{ event.housePoints[house.id] }}</span>
              </div>
            </ng-container>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Upcoming Events -->
  <div class="section">
    <h2>Upcoming Events</h2>
    <div class="events-list">
      <div 
        class="event-card upcoming" 
        *ngFor="let event of getUpcomingEvents(season.events)"
      >
        <div class="event-info">
          <div class="event-name">{{ event.name }}</div>
          <div class="event-date">{{ event.date | date:'MMM d, y' }}</div>
          <div class="event-type">{{ event.type | titlecase }}</div>
          <div class="event-description" *ngIf="event.description">{{ event.description }}</div>
        </div>
      </div>
    </div>
  </div>

  <!-- Player Statistics -->
  <div class="section">
    <h2>Top Performers</h2>
    <div class="player-stats">
      <div 
        class="player-stat-card" 
        *ngFor="let player of playerStats.slice(0, 10)"
      >
        <div class="player-info">
          <div class="player-name">{{ player.playerName }}</div>
          <div class="player-house" [style.color]="getHouseColor(player.houseId, season.houses)">
            {{ player.houseName }}
          </div>
        </div>
        <div class="player-points">{{ player.totalPoints }} pts</div>
      </div>
    </div>
  </div>
</div>

<div class="loading" *ngIf="!(currentSeason$ | async)">
  <p>Loading competition data...</p>
</div>

<!-- Secret Manager Portal Modal -->
<div class="secret-modal-overlay" *ngIf="showSecretModal" (click)="closeSecretModal()">
  <div class="secret-modal" (click)="$event.stopPropagation()">
    <div class="secret-modal-header">
      <h2>ðŸ”’ Manager Portal Access</h2>
      <button class="close-btn" (click)="closeSecretModal()">&times;</button>
    </div>
    <div class="secret-modal-content">
      <p>Enter your credentials to access the admin portal:</p>
      <div class="form-inputs">
        <div class="input-container">
          <input 
            type="text" 
            [(ngModel)]="username" 
            placeholder="Username..."
            class="form-input"
            (keyup.enter)="submitManagerPassword()">
        </div>
        <div class="input-container">
          <input 
            type="password" 
            [(ngModel)]="password" 
            placeholder="Password..."
            class="form-input"
            (keyup.enter)="submitManagerPassword()">
        </div>
      </div>
      <div class="modal-actions">
        <button class="btn btn-primary" (click)="submitManagerPassword()" [disabled]="isLoading">
          <span *ngIf="!isLoading">Access Portal</span>
          <span *ngIf="isLoading">Authenticating...</span>
        </button>
        <button class="btn btn-secondary" (click)="closeSecretModal()" [disabled]="isLoading">
          Cancel
        </button>
      </div>
      <div class="secret-hint">
        <small>ðŸ’¡ Hint: Type "secret" anywhere on this page to open this dialog</small>
      </div>
    </div>
  </div>
</div>
